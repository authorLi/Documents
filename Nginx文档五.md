## 五、设置哈希

为了快速处理静态数据集，例如服务器名称，map指令的值，MIME类型，请求标头字符串的名称，Nginx使用了哈希表。在开始和每次重新配置期间，Nginx会选择哈希表的最小可能大小，以使存储具有相同哈希值的键的存储桶大小不超过配置的参数（哈希桶的大小）。表的大小用桶表示。这个调整会继续下去，直到哈希表的大小超过了哈希参数设定的最大值。大多数的哈希有相关的值可以修改这些参数，例如，对于服务器名称哈希，它们是server_names_hash_max_size和server_names_hash_bucket_size这两个参数。

哈希桶的大小参数与作为处理器高速缓存行大小的倍数的大小对齐。如果一个哈希桶的大小等于一个处理器的高速缓存行大小，则在最坏的情况下，关键字搜索期间的内存访问次数将为两次——首先去计算桶的地址，然后在桶内搜索关键字的期间，因此，如果Nginx发出请求增加哈希最大值大小或桶大小的信息时，则应首先增加一个参数。